# 项目重构计划

## 重构目标

1. **代码结构优化** - 提高代码可维护性和可读性
2. **性能优化** - 优化人脸识别和物体检测性能
3. **移动端适配** - 完善响应式设计
4. **代码规范** - 统一代码风格和命名规范
5. **文档完善** - 添加详细的代码注释和使用文档

## 重构内容

### 1. 前端重构

#### 1.1 页面组件优化
- [x] Home.tsx - 主页面移动端适配
- [x] Login.tsx - 登录页面移动端适配
- [ ] Admin.tsx - 人员管理页面优化
- [ ] History.tsx - 识别记录页面优化
- [ ] BackendAdmin.tsx - 后台管理页面优化

#### 1.2 人脸识别功能
- [x] 黄色边框显示
- [x] 姓名/未知标注
- [x] 红色角标装饰
- [ ] 性能优化(使用optimized版本)
- [ ] 识别准确率提升

#### 1.3 UI组件整理
- [ ] 移除未使用的UI组件
- [ ] 统一组件样式
- [ ] 优化加载状态

### 2. 后端重构

#### 2.1 认证系统
- [x] 本地认证实现
- [x] 密码哈希加密
- [x] 会话管理
- [ ] 权限控制优化
- [ ] 安全性加固

#### 2.2 数据库优化
- [x] 添加password字段
- [ ] 索引优化
- [ ] 查询性能优化
- [ ] 数据验证

#### 2.3 API路由整理
- [x] 本地认证路由
- [ ] tRPC路由优化
- [ ] 错误处理统一
- [ ] API文档

### 3. 配置文件整理

- [ ] 环境变量规范
- [ ] 构建配置优化
- [ ] 依赖包清理
- [ ] TypeScript配置

### 4. 文档完善

- [x] 部署说明文档
- [ ] API文档
- [ ] 开发指南
- [ ] 用户手册

## 重构优先级

### 高优先级
1. ✅ 本地认证系统
2. ✅ 人脸检测可视化
3. ✅ 移动端基础适配
4. 🔄 代码注释和文档

### 中优先级
1. 性能优化
2. 其他页面移动端适配
3. 错误处理完善
4. 安全性加固

### 低优先级
1. 未使用代码清理
2. UI细节优化
3. 单元测试
4. CI/CD配置

## 已完成的工作

### 认证系统重构
- ✅ 移除OAuth依赖
- ✅ 实现本地用户名/密码登录
- ✅ bcryptjs密码加密
- ✅ JWT会话管理
- ✅ 登录页面创建
- ✅ 默认管理员账户

### 人脸识别可视化
- ✅ 黄色边框绘制
- ✅ 姓名标注显示
- ✅ 未知人脸标识
- ✅ 红色角标装饰
- ✅ 置信度显示

### 移动端适配
- ✅ 响应式布局调整
- ✅ 间距和字体大小适配
- ✅ 按钮尺寸优化
- ✅ 卡片padding调整
- ✅ 移动端内容顺序优化

### 数据库改进
- ✅ 添加password字段
- ✅ 数据库迁移脚本
- ✅ 用户初始化脚本

## 下一步计划

1. **代码注释** - 为关键函数添加详细注释
2. **性能优化** - 使用faceRecognition.optimized.ts
3. **错误处理** - 统一错误处理机制
4. **文档完善** - 添加API文档和开发指南
5. **安全加固** - 添加请求验证和防护

## 技术债务

1. OAuth相关代码未完全清理
2. 部分UI组件未使用但仍存在
3. 缺少单元测试
4. 缺少API文档
5. 环境变量配置需要规范化

## 性能指标

### 当前性能
- 物体检测: ~300ms/帧
- 人脸识别: ~500ms/帧
- 页面加载: ~2s

### 优化目标
- 物体检测: <200ms/帧
- 人脸识别: <300ms/帧
- 页面加载: <1.5s

